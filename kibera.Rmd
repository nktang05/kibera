---
title: "Kibera"
output: html_document
date: "2025-06-02"
---

Link to Git repo: https://github.com/nktang05/kibera.git

Link to Analysis: https://nktang05.github.io/kibera/KiberaAnalysis.html


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(mlr3learners) 
require(kknn)  
require(class)
require(ggplot2)
library(mlr3)
library(mlr3viz)
library(ggplot2)
library(data.table)
library(sqldf)

```



### Data Cleaning

```{r}
# read in data
setwd("~/Desktop/GRIT/Kibera")
data <- fread("~/Desktop/GRIT/Kibera/kibera_values_data.csv")

setnames(data, as.character(unlist(data[1, ])))

data <- data[-1, ]
```


```{r}
# get rid on unnecessary data columns
data$StartDate<- NULL
data$EndDate<- NULL
data$Status<- NULL
data$IPAddress<- NULL
data$Progress<- NULL
data$'Duration (in seconds)'<- NULL
data$Finished<- NULL
data$ RecordedDate<- NULL
data$ResponseId<- NULL
data$RecipientLastName<- NULL
data$RecipientFirstName<- NULL
data$RecipientEmail<- NULL
data$ExternalReference<- NULL
data$LocationLatitude<- NULL
data$LocationLongitude<- NULL
data$DistributionChannel<- NULL
data$UserLanguage<- NULL
data$"2.11_7_TEXT"<- NULL
data$"2.13_7_TEXT"<- NULL
data$"2.20_5_TEXT"<- NULL
data$"3.2_8_TEXT"<- NULL
data$"3.16_6_TEXT"<- NULL
data$"4.21_5_TEXT"<- NULL
data$"5.1_5_TEXT"<- NULL
data$"5.12_6_TEXT"<- NULL


#summary(data)

```




```{r}
# check and data types
data[, "1.1" := as.integer(data[["1.1"]])]

```

```{r}
# delete over 20 and under 13
data$`2.1` <- as.integer(data$`2.1`)
data <- data[data$'2.1' <= 20, ]
data <- data[data$'2.1' >= 13, ]



# Remove rows where gender is NA or an empty string
data <- data[!is.na(`2.2`) & `2.2` != "", ]

# delete in age is is NA or an empty string
data <- data[!is.na(`2.1`) & `2.1` != "", ]


```


```{r}
#CHECK FOR MALE CONDITIONALS
#change pregnant to NA if indicated Yes and Male
data$'4.8'[data$'2.2' == 2 & data$'4.8' == 1] <- NA

#change menstual to NA if indicated Yes and Male
data$'3.1'[data$'2.2' == 2 & (data[["3.1"]] == 1 | data[["3.1"]] == 2)] <- NA
# change menstrual age to NA if age and Male
data[["3.1_1_TEXT"]][data[["2.2"]] == 2 & data[["3.1_1_TEXT"]] != ""] <- NA
# change menstrual prodict to NA if age and Male
data[["3.2"]][data[["2.2"]] == 2 & data[["3.2"]] != ""] <- NA
data[["3.3"]][data[["2.2"]] == 2 & data[["3.3"]] != ""] <- NA
data[["3.4"]][data[["2.2"]] == 2 & data[["3.4"]] != ""] <- NA
data[["3.5"]][data[["2.2"]] == 2 & data[["3.5"]] != ""] <- NA
data[["3.6"]][data[["2.2"]] == 2 & data[["3.6"]] != ""] <- NA
data[["3.7"]][data[["2.2"]] == 2 & data[["3.7"]] != ""] <- NA
```

```{r}
#CHECK FOR SEX ACTIVITY CONDITIONALS
data[["3.9"]][data[["2.2"]] != 1 & data[["3.9"]] != ""] <- NA



```




```{r}
#query to see duplicate village numbers
sqldf("SELECT [1.2], COUNT(*) as count 
       FROM data 
       GROUP BY [1.2] 
       HAVING COUNT(*) > 1")
```


```{r}
#query checker for if male said they were pregnant
sqldf("SELECT [2.2], [4.8] 
      FROM data 
      WHERE [2.2] = 2 AND [4.8] = 1")
#query for male menstration
sqldf("SELECT [2.2], [3.1] 
      FROM data 
      WHERE [2.2] = 2 AND ([3.1] = 1 OR [3.1] = 2)")
#query for male menstration age
sqldf("SELECT [2.2], [3.1_1_TEXT]
       FROM data 
       WHERE [2.2] = 2 AND [3.1_1_TEXT] != ''")
sqldf("SELECT [2.2], [3.2]
       FROM data 
       WHERE [2.2] = 2 AND [3.2] != ''")
#3.3,3.4,3.5,3.6,3.7
sqldf("SELECT [2.2], [3.7]
       FROM data 
       WHERE [2.2] = 2 AND [3.7] != ''")


```
```{r}
# query for sex conditionals
sqldf("SELECT [3.8], [3.9]
       FROM data 
       WHERE [3.8] != 1 AND [3.9] != ''")

```


```{r}
#summary(data)
```


```{r}
# write new csv of clean data
fwrite(data, "kibera_values_cleaned.csv")
```

